<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Las Luchas de las Tribus - Tablero</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(to bottom, #8B4513 0%, #654321 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }

        .game-container {
            width: 95%;
            height: 95vh;
            background: rgba(0, 0, 0, 0.3);
            border: 4px solid #ffcc00;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 5px;
        }

        /* Header con informaci√≥n */
        .game-header {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .player-info {
            font-size: 1.2em;
        }

        /* Zona de combate */
        .combat-zone {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 40px;
            padding: 20px 0;
        }

        .battle-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 10px;
        }

        .opponent-row {
            border-bottom: 2px dashed rgba(255, 255, 255, 0.3);
        }

        /* Slots de combate */
        .combat-slot {
            width: 140px;
            height: 200px;
            border: 3px dashed rgba(255, 255, 255, 0.4);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .combat-slot.occupied {
            border-style: solid;
            border-color: #ffcc00;
        }

        /* Cartas */
        .card {
            width: 130px;
            height: 190px;
            background: linear-gradient(135deg, #5d0f19 0%, #3a0a10 100%);
            border: 3px solid #f5e6b9;
            border-radius: 8px;
            padding: 8px;
            cursor: grab;
            transition: transform 0.2s;
            position: relative;
        }

        .card:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px #ffcc00;
        }

        .card-header {
            font-size: 0.9em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 5px;
            color: #ffcc00;
        }

        .card-image {
            width: 100%;
            height: 80px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
            font-size: 0.7em;
        }

        .card-stats {
            display: flex;
            justify-content: space-around;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .stat {
            background: rgba(0, 0, 0, 0.5);
            padding: 3px 6px;
            border-radius: 3px;
        }

        .stat-atk { color: #ff4444; }
        .stat-vida { color: #44ff44; }
        .stat-vel { color: #4444ff; }
        .stat-cur { color: #ffaa00; }

        /* Mano del jugador */
        .hand-zone {
            height: 220px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            padding: 10px;
            border: 2px solid #ffcc00;
        }

        /* Botones */
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }

        button {
            padding: 12px 25px;
            font-size: 1.1em;
            background: #e6675e;
            color: white;
            border: 3px solid #ffcc00;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        button:hover {
            background: #c44f45;
        }

        button:disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* Carta del oponente */
        .card.healing-selected {
            border-color: #00ff00;
            box-shadow: 0 0 20px #00ff00;
        }

        .card.bot-card {
            width: 100px;
            height: 140px;
            font-size: 0.75em;
            background: linear-gradient(135deg, #1a0a0a 0%, #0a0505 100%);
            border-color: #ff0000;
        }

        .card.bot-card .card-header {
            font-size: 0.75em;
        }

        .card.bot-card .card-stats {
            font-size: 0.7em;
        }

        /* Mensajes de log */
        .game-log {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 300px;
            max-height: 400px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #ffcc00;
            border-radius: 5px;
            padding: 10px;
            overflow-y: auto;
            font-size: 0.85em;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 3px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Header -->
        <div class="game-header">
            <div class="player-info">
                <strong>Tribu Nora (Rival)</strong>
            </div>
            <div class="player-info" style="text-align: center;">
                <div style="font-size: 1.5em; color: #ffcc00;" id="timer">2:00</div>
                <div id="night-mode-indicator" style="display: none; color: #4444ff;">üåô MODO NOCHE üåô</div>
                <div style="font-size: 0.9em;">Cartas en mazo: <span id="deck-count">0</span></div>
            </div>
            <div class="player-info">
                <strong>Tribu Orah (T√∫)</strong>
            </div>
        </div>

        <!-- Mano del BOT (arriba) -->
        <div class="hand-zone" id="bot-hand" style="height: 120px; gap: 10px; margin-top: 10px; margin-bottom: 10px; opacity: 0.8;">
            <!-- Las cartas del bot se mostrar√°n aqu√≠ -->
        </div>

        <!-- Zona de combate -->
        <div class="combat-zone">
            <!-- Fila del oponente (ARRIBA) -->
            <div class="battle-row opponent-row" id="opponent-field">
                <div class="combat-slot" data-slot="0"></div>
                <div class="combat-slot" data-slot="1"></div>
                <div class="combat-slot" data-slot="2"></div>
            </div>

            <!-- Fila del jugador (ABAJO) -->
            <div class="battle-row player-row" id="player-field">
                <div class="combat-slot" data-slot="0"></div>
                <div class="combat-slot" data-slot="1"></div>
                <div class="combat-slot" data-slot="2"></div>
            </div>
        </div>

        <!-- Mano del jugador (abajo) -->
        <div class="hand-zone" id="player-hand">
            <!-- Las cartas se cargar√°n aqu√≠ -->
        </div>

        <!-- Controles -->
        <div class="controls">
            <button onclick="window.location.href='index.html'">Volver al Men√∫</button>
            <button id="end-turn-btn" onclick="endTurn()">Finalizar Turno</button>
        </div>
    </div>

    <!-- Log de eventos -->
    <div class="game-log" id="game-log">
        <strong>--- Log de Juego ---</strong>
    </div>

    <script>
        // ========================================
        // VARIABLES GLOBALES
        // ========================================
        let deck = [];
        let playerHand = [];
        let playerField = [null, null, null];
        let opponentField = [null, null, null];
        let currentTurn = 1;
        let gameActive = true;
        
        // Variables del timer y modo noche
        let timeRemaining = 120;
        let timerInterval = null;
        let nightModeActive = false;
        
        // BOT
        let botDeck = [];
        let botHand = [];
        let botDifficulty = 'medium';
        
        // Sistema de curaciones
        let selectedHealingCard = null;

        // ========================================
        // FUNCIONES DE LOG
        // ========================================
        function addLog(message) {
            const logDiv = document.getElementById('game-log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `[Turno ${currentTurn}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        // ========================================
        // SISTEMA DE TIMER Y MODO NOCHE
        // ========================================
        function startTimer() {
            timerInterval = setInterval(() => {
                if (!gameActive) {
                    clearInterval(timerInterval);
                    return;
                }
                
                timeRemaining--;
                updateTimerDisplay();
                
                // Activar modo noche al minuto 1 (60 segundos restantes)
                if (timeRemaining === 60 && !nightModeActive) {
                    activateNightMode();
                }
                
                // Fin del tiempo
                if (timeRemaining <= 0) {
                    endGame('tiempo');
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            const timerDisplay = document.getElementById('timer');
            timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Cambiar color cuando queda poco tiempo
            if (timeRemaining <= 30) {
                timerDisplay.style.color = '#ff4444';
            } else if (timeRemaining <= 60) {
                timerDisplay.style.color = '#ffaa00';
            }
        }

        function activateNightMode() {
            nightModeActive = true;
            addLog('üåô ¬°MODO NOCHE ACTIVADO! Todos los luchadores pierden 1 de vida');
            
            // Mostrar indicador visual
            document.getElementById('night-mode-indicator').style.display = 'block';
            document.body.style.background = 'linear-gradient(to bottom, #1a0f2e 0%, #0a0514 100%)';
            
            // Aplicar da√±o a todos los luchadores en el campo
            applyNightModeDamage();
        }

        function applyNightModeDamage() {
            // Da√±o al campo del jugador
            playerField.forEach((card, index) => {
                if (card && card.tipo === 'Luchador') {
                    // TODAS las estad√≠sticas bajan 1
                    card.vida -= 1;
                    card.ataque = Math.max(1, card.ataque - 1);
                    card.velocidad = Math.max(1, card.velocidad - 1);
                    
                    addLog(`${card.nombre}: -1 Vida, -1 Ataque, -1 Velocidad (Modo Noche)`);
                    
                    if (card.vida <= 0) {
                        addLog(`üíÄ ${card.nombre} ha sido derrotado por la noche`);
                        playerField[index] = null;
                    }
                }
            });
            
            // Da√±o al campo del oponente
            opponentField.forEach((card, index) => {
                if (card && card.tipo === 'Luchador') {
                    // TODAS las estad√≠sticas bajan 1
                    card.vida -= 1;
                    card.ataque = Math.max(1, card.ataque - 1);
                    card.velocidad = Math.max(1, card.velocidad - 1);
                    
                    addLog(`${card.nombre} (enemigo): -1 en todas las stats (Modo Noche)`);
                    
                    if (card.vida <= 0) {
                        addLog(`üíÄ ${card.nombre} (enemigo) ha sido derrotado por la noche`);
                        opponentField[index] = null;
                    }
                }
            });
            
            renderField();
        }

        // ========================================
        // CARGA DE CARTAS
        // ========================================
        async function loadCards() {
            try {
                // Cargar dificultad del bot desde configuraciones
                botDifficulty = localStorage.getItem('botDifficulty') || 'medium';
                
                // Intentar cargar cartas desde sessionStorage (viene de mano.html)
                const savedCards = sessionStorage.getItem('selectedCards');
                
                if (savedCards) {
                    deck = JSON.parse(savedCards);
                    addLog('Cartas cargadas desde tu selecci√≥n');
                } else {
                    // Si no hay cartas guardadas, cargar aleatorias
                    const response = await fetch('data/cartas.json');
                    const data = await response.json();
                    
                    const orahCards = data.mazo_tribu_orah;
                    const shuffled = orahCards.sort(() => 0.5 - Math.random());
                    
                    const luchadores = shuffled.filter(c => c.tipo === 'Luchador').slice(0, 3);
                    const curaciones = shuffled.filter(c => c.tipo === 'Curaci√≥n').slice(0, 2);
                    
                    deck = [...luchadores, ...curaciones];
                    addLog('Cartas aleatorias cargadas');
                }
                
                // Cargar mazo del BOT (Tribu Nora)
                await loadBotDeck();
                
                addLog(`Juego iniciado - Dificultad del bot: ${botDifficulty.toUpperCase()}`);
                updateDeckCount();
                drawInitialHand();
            } catch (error) {
                addLog('ERROR: No se pudo cargar cartas.json');
                console.error(error);
            }
        }

        async function loadBotDeck() {
            try {
                const response = await fetch('data/cartas.json');
                const data = await response.json();
                
                const noraCards = data.mazo_tribu_nora;
                const shuffled = noraCards.sort(() => 0.5 - Math.random());
                
                // BOT tiene 3 luchadores + 2 curaciones (igual que el jugador)
                const luchadores = shuffled.filter(c => c.tipo === 'Luchador').slice(0, 3);
                const curaciones = shuffled.filter(c => c.tipo === 'Curaci√≥n').slice(0, 2);
                
                botDeck = [...luchadores, ...curaciones];
                
                // Dar mano inicial al bot
                botHand = [...botDeck];
                
                addLog(`Bot cargado: 3 luchadores + 2 curaciones`);
                renderBotHand();
            } catch (error) {
                console.error('Error cargando mazo del bot:', error);
            }
        }

        function renderBotHand() {
            const botHandDiv = document.getElementById('bot-hand');
            botHandDiv.innerHTML = '';
            
            botHand.forEach((card) => {
                const cardElement = createBotCardElement(card);
                botHandDiv.appendChild(cardElement);
            });
        }

        function createBotCardElement(card) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'card bot-card';
            
            let statsHTML = '';
            if (card.tipo === 'Luchador') {
                statsHTML = `
                    <div class="card-stats">
                        <span class="stat stat-atk">‚öî${card.ataque}</span>
                        <span class="stat stat-vida">‚ù§${card.vida}</span>
                        <span class="stat stat-vel">‚ö°${card.velocidad}</span>
                    </div>
                `;
            } else {
                statsHTML = `
                    <div class="card-stats">
                        <span class="stat stat-cur">‚úö${card.curacion}</span>
                    </div>
                `;
            }
            
            cardDiv.innerHTML = `
                <div class="card-header">${card.nombre}</div>
                <div class="card-image" style="height: 50px; font-size: 0.65em;">${card.tipo}</div>
                ${statsHTML}
            `;
            
            return cardDiv;
        }

        function updateDeckCount() {
            document.getElementById('deck-count').textContent = deck.length;
        }

        function drawInitialHand() {
            deck.forEach(card => {
                playerHand.push(card);
            });
            renderHand();
        }

        // ========================================
        // RENDERIZADO DE CARTAS
        // ========================================
        function renderHand() {
            const handDiv = document.getElementById('player-hand');
            handDiv.innerHTML = '';
            
            playerHand.forEach((card, index) => {
                const cardElement = createCardElement(card, index);
                
                // Si es curaci√≥n, agregar evento de clic
                if (card.tipo === 'Curaci√≥n') {
                    cardElement.onclick = () => selectHealingCard(card, index);
                    cardElement.style.cursor = 'pointer';
                }
                
                handDiv.appendChild(cardElement);
            });
        }

        function selectHealingCard(card, handIndex) {
            if (selectedHealingCard === handIndex) {
                // Deseleccionar
                selectedHealingCard = null;
                renderHand();
                clearHealableSlots();
                addLog('Curaci√≥n cancelada');
            } else {
                // Seleccionar esta carta de curaci√≥n
                selectedHealingCard = handIndex;
                renderHand();
                highlightHealableSlots();
                addLog(`Seleccionaste: ${card.nombre} - Clic en un luchador para curarlo`);
            }
        }

        function highlightHealableSlots() {
            const playerSlots = document.querySelectorAll('#player-field .combat-slot');
            playerSlots.forEach((slot, index) => {
                if (playerField[index] && playerField[index].tipo === 'Luchador') {
                    slot.classList.add('healable');
                    slot.onclick = () => applyHealing(index);
                }
            });
        }

        function clearHealableSlots() {
            const playerSlots = document.querySelectorAll('#player-field .combat-slot');
            playerSlots.forEach(slot => {
                slot.classList.remove('healable');
                slot.onclick = null;
            });
        }

        function applyHealing(slotIndex) {
            if (selectedHealingCard === null) return;
            
            const healCard = playerHand[selectedHealingCard];
            const targetCard = playerField[slotIndex];
            
            if (!targetCard) return;
            
            // Aplicar curaci√≥n
            const healAmount = nightModeActive ? Math.floor(healCard.curacion / 2) : healCard.curacion;
            targetCard.vida += healAmount;
            
            addLog(`${targetCard.nombre} curado +${healAmount} vida (Total: ${targetCard.vida})`);
            
            // Remover carta de curaci√≥n de la mano
            playerHand.splice(selectedHealingCard, 1);
            selectedHealingCard = null;
            
            renderHand();
            renderField();
            clearHealableSlots();
        }

        function createCardElement(card, handIndex = -1) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'card';
            
            // Resaltar si es la carta de curaci√≥n seleccionada
            if (handIndex === selectedHealingCard) {
                cardDiv.classList.add('healing-selected');
            }
            
            cardDiv.draggable = true;
            
            if (handIndex >= 0) {
                cardDiv.dataset.handIndex = handIndex;
                cardDiv.ondragstart = dragStart;
            }
            
            let statsHTML = '';
            if (card.tipo === 'Luchador') {
                statsHTML = `
                    <div class="card-stats">
                        <span class="stat stat-atk">‚öî ${card.ataque}</span>
                        <span class="stat stat-vida">‚ù§ ${card.vida}</span>
                        <span class="stat stat-vel">‚ö° ${card.velocidad}</span>
                    </div>
                `;
            } else {
                statsHTML = `
                    <div class="card-stats">
                        <span class="stat stat-cur">‚úö ${card.curacion}</span>
                    </div>
                `;
            }
            
            cardDiv.innerHTML = `
                <div class="card-header">${card.nombre}</div>
                <div class="card-image">${card.tipo}</div>
                <div style="font-size: 0.75em; text-align: center; margin: 5px 0;">
                    ${card.descripcion.substring(0, 50)}...
                </div>
                ${statsHTML}
            `;
            
            return cardDiv;
        }

        // ========================================
        // DRAG AND DROP
        // ========================================
        let draggedCardIndex = null;

        function dragStart(e) {
            draggedCardIndex = parseInt(e.target.dataset.handIndex);
            e.dataTransfer.effectAllowed = 'move';
        }

        // Hacer que los slots acepten drop
        document.addEventListener('DOMContentLoaded', () => {
            const playerSlots = document.querySelectorAll('#player-field .combat-slot');
            playerSlots.forEach(slot => {
                slot.ondragover = dragOver;
                slot.ondrop = drop;
            });
        });

        function dragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function drop(e) {
            e.preventDefault();
            
            if (draggedCardIndex === null) return;
            
            const slotIndex = parseInt(e.currentTarget.dataset.slot);
            const card = playerHand[draggedCardIndex];
            
            // Verificar si el slot est√° ocupado
            if (playerField[slotIndex] !== null) {
                addLog('Ese slot ya est√° ocupado');
                return;
            }
            
            // Solo luchadores van al campo
            if (card.tipo === 'Luchador') {
                playerField[slotIndex] = card;
                playerHand.splice(draggedCardIndex, 1);
                
                addLog(`Jugaste: ${card.nombre}`);
                renderHand();
                renderField();
            } else {
                addLog('Las curaciones no se juegan en el campo');
            }
            
            draggedCardIndex = null;
        }

        function renderField() {
            // Renderizar campo del jugador
            const playerSlots = document.querySelectorAll('#player-field .combat-slot');
            playerSlots.forEach((slot, index) => {
                slot.innerHTML = '';
                if (playerField[index]) {
                    const card = createCardElement(playerField[index]);
                    card.draggable = false;
                    slot.appendChild(card);
                    slot.classList.add('occupied');
                } else {
                    slot.classList.remove('occupied');
                }
            });
            
            // Renderizar campo del oponente
            const opponentSlots = document.querySelectorAll('#opponent-field .combat-slot');
            opponentSlots.forEach((slot, index) => {
                slot.innerHTML = '';
                if (opponentField[index]) {
                    const card = createCardElement(opponentField[index]);
                    card.classList.add('opponent');
                    card.draggable = false;
                    slot.appendChild(card);
                    slot.classList.add('occupied');
                } else {
                    slot.classList.remove('occupied');
                }
            });
        }

        // ========================================
        // FIN DEL JUEGO
        // ========================================
        function endGame(reason) {
            gameActive = false;
            clearInterval(timerInterval);
            
            let message = '';
            if (reason === 'tiempo') {
                // Contar luchadores vivos
                const playerAlive = playerField.filter(c => c !== null).length;
                const opponentAlive = opponentField.filter(c => c !== null).length;
                
                if (playerAlive > opponentAlive) {
                    message = `‚è∞ ¬°VICTORIA! Tiempo agotado. Tienes m√°s luchadores (${playerAlive} vs ${opponentAlive})`;
                } else if (opponentAlive > playerAlive) {
                    message = `‚è∞ DERROTA. Tiempo agotado. El oponente tiene m√°s luchadores (${opponentAlive} vs ${playerAlive})`;
                } else {
                    message = `‚è∞ EMPATE. Ambos tienen ${playerAlive} luchadores`;
                }
            } else if (reason === 'sin_cartas') {
                message = 'üíÄ DERROTA. Te quedaste sin cartas';
            } else if (reason === 'victoria') {
                message = 'üéâ ¬°VICTORIA! Derrotaste a todos los luchadores enemigos';
            }
            
            addLog(message);
            alert(message);
            document.getElementById('end-turn-btn').disabled = true;
        }
        // ========================================
        // L√ìGICA DE TURNOS
        // ========================================
        function endTurn() {
            if (!gameActive) return;
            
            addLog('--- Fin de tu turno ---');
            
            // Fase de combate
            processCombat();
            
            // Verificar condiciones de victoria
            checkVictoryConditions();
            
            // Turno del oponente
            setTimeout(() => {
                if (gameActive) {
                    opponentTurn();
                    currentTurn++;
                    addLog('--- Tu turno ---');
                }
            }, 1500);
        }

        function checkVictoryConditions() {
            const playerAlive = playerField.filter(c => c !== null).length;
            const opponentAlive = opponentField.filter(c => c !== null).length;
            
            if (opponentAlive === 0 && playerAlive > 0) {
                endGame('victoria');
            } else if (playerAlive === 0 && opponentAlive > 0) {
                endGame('sin_cartas');
            }
        }

        function processCombat() {
            addLog('=== FASE DE COMBATE ===');
            
            for (let i = 0; i < 3; i++) { // CAMBIADO A 3
                const playerCard = playerField[i];
                const opponentCard = opponentField[i];
                
                if (playerCard && opponentCard) {
                    // Combate directo
                    resolveCombat(playerCard, opponentCard, i);
                }
            }
        }

        function resolveCombat(card1, card2, slotIndex) {
            // Determinar qui√©n ataca primero por velocidad
            let attacker, defender;
            if (card1.velocidad > card2.velocidad) {
                attacker = card1;
                defender = card2;
            } else if (card2.velocidad > card1.velocidad) {
                attacker = card2;
                defender = card1;
            } else {
                // Mismo velocidad - aleatorio
                if (Math.random() > 0.5) {
                    attacker = card1;
                    defender = card2;
                } else {
                    attacker = card2;
                    defender = card1;
                }
            }
            
            // El atacante golpea primero
            defender.vida -= attacker.ataque;
            addLog(`${attacker.nombre} ataca a ${defender.nombre} (${attacker.ataque} da√±o)`);
            
            // Si el defensor sobrevive, contraataca
            if (defender.vida > 0) {
                attacker.vida -= defender.ataque;
                addLog(`${defender.nombre} contraataca a ${attacker.nombre} (${defender.ataque} da√±o)`);
            }
            
            // Eliminar cartas muertas
            if (card1.vida <= 0) {
                addLog(`üíÄ ${card1.nombre} ha sido derrotado`);
                playerField[slotIndex] = null;
            }
            if (card2.vida <= 0) {
                addLog(`üíÄ ${card2.nombre} ha sido derrotado`);
                opponentField[slotIndex] = null;
            }
            
            renderField();
        }

        function opponentTurn() {
            addLog('--- Turno del oponente ---');
            
            if (!gameActive || botHand.length === 0) {
                addLog('Bot sin cartas disponibles');
                return;
            }
            
            // Primero, intentar usar curaci√≥n si tiene luchadores heridos
            const healingCards = botHand.filter(c => c.tipo === 'Curaci√≥n');
            const injuredSlots = opponentField
                .map((card, index) => ({ card, index }))
                .filter(slot => slot.card && slot.card.tipo === 'Luchador' && slot.card.vida < 8);
            
            if (healingCards.length > 0 && injuredSlots.length > 0) {
                // 50% de probabilidad de usar curaci√≥n (o 70% en dif√≠cil)
                const useHealing = botDifficulty === 'hard' ? Math.random() < 0.7 : Math.random() < 0.5;
                
                if (useHealing) {
                    const healCard = healingCards[0];
                    const targetSlot = injuredSlots[0];
                    
                    const healAmount = nightModeActive ? Math.floor(healCard.curacion / 2) : healCard.curacion;
                    targetSlot.card.vida += healAmount;
                    
                    addLog(`Bot us√≥ ${healCard.nombre} en ${targetSlot.card.nombre} (+${healAmount} vida)`);
                    
                    // Remover carta de la mano del bot
                    const cardIndex = botHand.findIndex(c => c.id === healCard.id);
                    if (cardIndex !== -1) {
                        botHand.splice(cardIndex, 1);
                    }
                    
                    renderField();
                    renderBotHand();
                    return;
                }
            }
            
            // Si no us√≥ curaci√≥n, jugar luchador
            const emptySlot = opponentField.findIndex(slot => slot === null);
            
            if (emptySlot !== -1) {
                // Solo seleccionar luchadores de la mano
                const fighters = botHand.filter(c => c.tipo === 'Luchador');
                
                if (fighters.length === 0) {
                    addLog('Bot sin luchadores disponibles');
                    return;
                }
                
                // IA del BOT seg√∫n dificultad (solo para luchadores)
                const cardToPlay = selectBotCard(emptySlot, fighters);
                
                if (cardToPlay) {
                    // Crear copia de la carta para el bot
                    const botCard = {
                        ...cardToPlay,
                        id: 'bot_' + Date.now() + '_' + Math.random()
                    };
                    
                    opponentField[emptySlot] = botCard;
                    addLog(`Oponente jug√≥: ${botCard.nombre} (ATK:${botCard.ataque} VID:${botCard.vida} VEL:${botCard.velocidad})`);
                    
                    // Remover carta de la mano del bot
                    const cardIndex = botHand.findIndex(c => c.id === cardToPlay.id);
                    if (cardIndex !== -1) {
                        botHand.splice(cardIndex, 1);
                    }
                    
                    renderField();
                    renderBotHand();
                }
            } else {
                addLog('Campo del oponente lleno');
            }
        }

        function selectBotCard(targetSlot, availableCards) {
            if (availableCards.length === 0) return null;
            
            const playerCardInSlot = playerField[targetSlot];
            
            switch(botDifficulty) {
                case 'easy':
                    // F√°cil: Juega carta aleatoria
                    return availableCards[Math.floor(Math.random() * availableCards.length)];
                
                case 'medium':
                    // Medio: Intenta igualar el ataque del jugador
                    if (playerCardInSlot) {
                        const similarCards = availableCards.filter(c => 
                            Math.abs(c.ataque - playerCardInSlot.ataque) <= 2
                        );
                        if (similarCards.length > 0) {
                            return similarCards[Math.floor(Math.random() * similarCards.length)];
                        }
                    }
                    return availableCards[Math.floor(Math.random() * availableCards.length)];
                
                case 'hard':
                    // Dif√≠cil: Juega la mejor carta estrat√©gicamente
                    if (playerCardInSlot) {
                        // Busca carta que pueda ganar por velocidad
                        const fasterCards = availableCards.filter(c => 
                            c.velocidad > playerCardInSlot.velocidad && 
                            c.ataque >= playerCardInSlot.vida
                        );
                        if (fasterCards.length > 0) {
                            return fasterCards.reduce((best, card) => 
                                card.ataque > best.ataque ? card : best
                            );
                        }
                        
                        // Si no, busca la carta m√°s fuerte disponible
                        return availableCards.reduce((best, card) => {
                            const bestScore = best.ataque + best.vida + best.velocidad;
                            const cardScore = card.ataque + card.vida + card.velocidad;
                            return cardScore > bestScore ? card : best;
                        });
                    }
                    // Si no hay rival, juega la m√°s fuerte
                    return availableCards.reduce((best, card) => 
                        (card.ataque + card.vida) > (best.ataque + best.vida) ? card : best
                    );
                
                default:
                    return availableCards[0];
            }
        }

        // ========================================
        // INICIALIZACI√ìN
        // ========================================
        window.onload = () => {
            loadCards();
            startTimer();
            addLog('=== Bienvenido a Las Luchas de las Tribus ===');
            addLog('Tienes 2 minutos - Modo Noche se activa al minuto 1');
            addLog('Arrastra tus cartas luchadores al campo');
            
            // El BOT juega sus cartas iniciales despu√©s de cargar
            setTimeout(() => {
                botInitialPlay();
            }, 2000);
        };
        
        // ========================================
        // JUGADA INICIAL DEL BOT
        // ========================================
        function botInitialPlay() {
            addLog('--- Bot jugando sus cartas iniciales ---');
            
            // El bot juega sus 3 luchadores autom√°ticamente
            const fighters = botHand.filter(c => c.tipo === 'Luchador');
            
            for (let i = 0; i < 3 && i < fighters.length; i++) {
                const card = fighters[i];
                const botCard = {
                    ...card,
                    id: 'bot_' + Date.now() + '_' + i
                };
                
                opponentField[i] = botCard;
                addLog(`Bot jug√≥: ${botCard.nombre}`);
                
                // Remover de la mano
                const cardIndex = botHand.findIndex(c => c.id === card.id);
                if (cardIndex !== -1) {
                    botHand.splice(cardIndex, 1);
                }
            }
            
            renderField();
            renderBotHand();
            addLog('¬°Ahora es tu turno! Arrastra tus luchadores al campo');
        }
    </script>
</body>
</html>